on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * 1'

name: Check links
jobs:
  link-checker:
    name: Check links (live)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: echo "/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin" >> $GITHUB_PATH
      - run: brew install muffet
      - name: Check
        run: muffet --json https://publicatie.centrumvoorstandaarden.nl/ > muffet.json
        continue-on-error: true
      - name: Report
        run: python ./scripts/muffet-json.py
      - run: mv links.md links-live.md
      - run: rm muffet.json
      - name: Commit
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Update links report (live)
          commit_user_name: GitHub Actions
          commit_user_email: api@logius.nl
          commit_author: Standaardenbeheer <api@logius.nl>
